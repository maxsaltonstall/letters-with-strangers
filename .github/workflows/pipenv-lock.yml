name: Check Pipfile.lock

on: push

jobs:
  test-pipfile:
    name: Test Pipfile.lock
    runs-on: ubuntu-latest

    steps:
      - name: Checkout GitHub repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x

      - name: Install pipenv
        run: python -m pip install --upgrade pipenv
      
      - name: Generate Pipfile.lock
        run: python -m pipenv lock
      
      - name: Verify Changed files
        uses: tj-actions/verify-changed-files@v5.5
        id: changed_files
        with:
          files: Pipfile.lock
      
      - name: Display changed files
        if: steps.changed_files.outputs.files_changed == 'true'
        run: |
          echo "Changed files: ${{ steps.changed_files.outputs.changed_files }}"  # Outputs: test_directory/new.txt

      - name: Perform action when files change.
        if: steps.changed_files.outputs.files_changed == 'true'
        run: |
          echo "Looks like you have an invalid Pipfile.lock! Try running "pipenv lock", and then try again"
          exit 1
